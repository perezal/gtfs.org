machine:
  environment:
    NOKOGIRI_USE_SYSTEM_LIBRARIES: true # speeds up installation of html-proofer

# checkout:
#   post:
#     - git clone git@github.com:perezal/best-practices.git

dependencies:
  post:
    - git clone git@github.com:perezal/gtfs-best-practices.git _best-practices/

test:
  post:
    # - bundle exec htmlproofer ./_site --allow-hash-href --check-favicon --check-html --disable-external
      - bundle exec jekyll build

deployment:
  prod:
    branch: gtfs-refit
    commands:
      - sudo pip install -U awscli
      - rsync -va --delete ./_site/ ${WEBSERVER}:${WEBADDRESS}
      - AWS_ACCESS_KEY_ID=${PROD_AWS_ACCESS_KEY_ID} AWS_SECRET_ACCESS_KEY=${PROD_AWS_SECRET_ACCESS_KEY} aws s3 sync _site s3://alexperez.ninja/
